<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Free Fire Items</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      position: relative;
      min-height: 100vh;
    }
    
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('https://i.ibb.co/TxSLMYdV/8d402dc5c8a8.png');
      background-size: 70% auto;
      background-repeat: no-repeat;
      background-position: center center;
      opacity: 0.3;
      z-index: -1;
      pointer-events: none;
    }

    h1 {
      padding: 15px;
      text-align: center;
      margin: 0;
      background-color: rgba(0, 0, 0, 0.7);
    }

    .search-container {
      padding: 3px;
      text-align: center;
      background-color: rgba(0, 0, 0, 0.7);
      width: 100vw;
    }

    #searchInput {
      height: 30px;
      padding: 6px 20px;
      width: 100vw;
      max-width: 85%;
      border-radius: 20px;
      border: none;
      background-color: #222;
      color: white;
      font-size: 16px;
    }

    .search-hint {
      color: #aaa;
      font-size: 12px;
      padding: 5px;
      text-align: center;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      padding: 15px;
    }

    .item {
      background-color: transparent;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      aspect-ratio: 1/1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    .item:hover {
      transform: scale(1.05);
      background-color: rgba(34, 34, 34, 0.9);
    }

    .item img {
      width: 70px;
      height: 70px;
      border-radius: 5px;
      object-fit: cover;
    }

    .item-rarity {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .rarity-blue {
      background-color: #1E90FF;
      box-shadow: 0 0 5px #1E90FF;
    }

    .rarity-purple {
      background-color: #9370DB;
      box-shadow: 0 0 5px #9370DB;
    }

    .rarity-red {
      background-color: #FF4500;
      box-shadow: 0 0 5px #FF4500;
    }

    .rarity-gold {
      background-color: #FFD700;
      box-shadow: 0 0 5px #FFD700;
    }

    .pagination {
      display: flex;
      justify-content: flex-start;
      margin: 15px 0;
      gap: 5px;
      flex-wrap: nowrap;
      padding: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      overflow-x: auto;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
    }

    .pagination::-webkit-scrollbar {
      display: none;
    }

    .page-btn {
      background-color: #333;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      min-width: 36px;
      text-align: center;
      flex-shrink: 0;
    }

    .page-btn:hover {
      background-color: #555;
      transform: translateY(-2px);
    }

    .page-btn.active {
      background-color: #007bff;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0, 123, 255, 0.5);
    }

    .page-btn.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .page-nav {
      background-color: #444;
      font-weight: bold;
    }

    .page-dots {
      background: none;
      color: white;
      cursor: default;
      padding: 6px 2px;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #aaa;
    }

    .error {
      text-align: center;
      padding: 20px;
      color: red;
      background-color: rgba(0, 0, 0, 0.7);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      z-index: 100;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background-color: #222;
      padding: 25px;
      border-radius: 10px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      border: 1px solid #444;
    }

    .modal-close {
      float: right;
      cursor: pointer;
      font-size: 24px;
      color: #aaa;
      transition: color 0.2s;
    }

    .modal-close:hover {
      color: white;
    }

    .modal-title {
      font-size: 20px;
      margin-bottom: 15px;
      color: gold;
      text-align: center;
    }

    .modal-img-container {
      text-align: center;
      margin-bottom: 15px;
    }

    .modal-img {
      width: 120px;
      height: 120px;
      border-radius: 10px;
      object-fit: cover;
      border: 2px solid gold;
    }

    .modal-detail {
      margin-bottom: 10px;
      font-size: 15px;
      padding: 8px;
      background-color: rgba(0,0,0,0.3);
      border-radius: 5px;
    }

    .detail-label {
      color: #aaa;
      display: inline-block;
      width: 100px;
      font-weight: bold;
    }

    .copy-btn {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 10px;
      font-size: 12px;
      transition: background-color 0.2s;
    }

    .copy-btn:hover {
      background-color: #0056b3;
    }

    .copy-btn.copied {
      background-color: #28a745;
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: repeat(4, 1fr);
      }
      
      .item img {
        width: 60px;
        height: 60px;
      }
    }

    @media (max-width: 480px) {
      .grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        padding: 10px;
      }
      
      .item img {
        width: 50px;
        height: 50px;
      }
      
      .pagination {
        gap: 3px;
      }
      
      .page-btn {
        padding: 4px 8px;
        min-width: 30px;
      }
    }
  </style>
</head>
<body>

<div class="search-container">
  <input type="text" id="searchInput" placeholder="Search by items (e.g. 'Rare:RED', 'OB', 'Reanimation Jutsu')">
</div>

<div class="grid" id="itemContainer"></div>
<div class="pagination" id="pagination"></div>
<div class="loading" id="loading">Loading items...</div>
<div class="error" id="error" style="display:none;"></div>

<!-- Modal for item details -->
<div class="modal" id="itemModal">
  <div class="modal-content">
    <span class="modal-close" id="modalClose">&times;</span>
    <div class="modal-title" id="modalTitle">Item Details</div>
    <div class="modal-img-container">
      <img class="modal-img" id="modalImg" src="" alt="Item Icon">
    </div>
    <div class="modal-details" id="modalDetails"></div>
  </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<script>
  // First fetch the Firebase config from JSON file
  fetch('firebase-config.json')
    .then(response => response.json())
    .then(firebaseConfig => {
      // Initialize Firebase with the config
      const app = firebase.initializeApp(firebaseConfig);
      const database = firebase.database();

      // Constants
      const itemsPerPage = 40;
      let allItems = [];
      let filteredItems = [];
      let currentPage = 1;
      let totalPages = 1;

      // DOM elements
      const searchInput = document.getElementById("searchInput");
      const itemModal = document.getElementById("itemModal");
      const modalClose = document.getElementById("modalClose");
      const modalTitle = document.getElementById("modalTitle");
      const modalImg = document.getElementById("modalImg");
      const modalDetails = document.getElementById("modalDetails");

      // Fields to hide in modal
      const HIDDEN_FIELDS = ['key', 'icon', 'IconInAB'];

      // Fetch data from Firebase
      function fetchData() {
        document.getElementById("loading").style.display = "block";
        document.getElementById("error").style.display = "none";
        
        database.ref('/').once('value')
          .then((snapshot) => {
            document.getElementById("loading").style.display = "none";
            const data = snapshot.val();
            
            if (!data) {
              throw new Error("Database is empty");
            }
            
            // Convert object to array
            allItems = Object.entries(data).map(([key, value]) => {
              return { key, ...value };
            }).filter(item => item.itemID);
            
            if (allItems.length === 0) {
              throw new Error("No items found with itemID");
            }
            
            // Sort items by itemID
            allItems.sort((a, b) => a.itemID - b.itemID);
            filteredItems = [...allItems];
            
            updatePagination();
            loadPage(1);
          })
          .catch((error) => {
            console.error("Error fetching data:", error);
            showError(error.message);
          });
      }

      // Filter items based on search input
      function filterItems() {
        const searchTerm = searchInput.value.toLowerCase().trim();
        
        if (searchTerm === '') {
          filteredItems = [...allItems];
        } else {
          // Check for key:value search (e.g. "Rare:RED", "tag:OB50")
          const keyValueMatch = searchTerm.match(/^([a-z0-9_]+):(.+)$/i);
          
          if (keyValueMatch) {
            const searchKey = keyValueMatch[1].toLowerCase();
            const searchValue = keyValueMatch[2].toLowerCase();
            
            filteredItems = allItems.filter(item => {
              // Check if item has this property
              if (item.hasOwnProperty(searchKey)) {
                const itemValue = String(item[searchKey]).toLowerCase();
                return itemValue.includes(searchValue);
              }
              return false;
            });
          } else {
            // Regular search - check all fields
            filteredItems = allItems.filter(item => {
              for (const [key, value] of Object.entries(item)) {
                // Skip hidden and special fields
                if (HIDDEN_FIELDS.includes(key)) continue;
                
                // Convert value to string and check
                const strValue = String(value).toLowerCase();
                if (strValue.includes(searchTerm)) {
                  return true;
                }
              }
              return false;
            });
          }
        }
        
        currentPage = 1;
        updatePagination();
        loadPage(1);
      }

      // Update pagination based on filtered items
      function updatePagination() {
        totalPages = Math.ceil(filteredItems.length / itemsPerPage) || 1;
        setupPagination();
      }

      // Load items for specific page
      function loadPage(page) {
        currentPage = page;
        const container = document.getElementById("itemContainer");
        container.innerHTML = "";
        
        const start = (page - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const pageItems = filteredItems.slice(start, end);
        
        if (pageItems.length === 0) {
          container.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:20px;">No items found</div>';
          return;
        }
        
        pageItems.forEach(item => {
          const itemDiv = createItemElement(item);
          container.appendChild(itemDiv);
        });
        
        updateActiveButton();
        
        // Scroll to top of items
        window.scrollTo({
          top: document.getElementById("searchInput").offsetHeight,
          behavior: 'smooth'
        });
      }

      // Create item DOM element
      function createItemElement(item) {
        const div = document.createElement("div");
        div.className = "item";
        
        // Use description or itemID as title
        const itemName = item.description || item.Name || `Item ${item.itemID}`;
        div.title = itemName;
        
        // Item Image
        const img = document.createElement("img");
        img.src = `https://freefireinfo.vercel.app/icon?id=${item.itemID}`;
        img.alt = itemName;
        img.onerror = () => {
          img.src = "https://via.placeholder.com/70x70?text=?";
        };
        div.appendChild(img);
        
        // Add rarity indicator if available
        if (item.Rare) {
          const rarityDot = document.createElement("div");
          rarityDot.className = "item-rarity";
          
          switch(item.Rare.toUpperCase()) {
            case "BLUE":
              rarityDot.classList.add("rarity-blue");
              break;
            case "PURPLE":
            case "VIOLET":
              rarityDot.classList.add("rarity-purple");
              break;
            case "RED":
              rarityDot.classList.add("rarity-red");
              break;
            case "GOLD":
            case "YELLOW":
              rarityDot.classList.add("rarity-gold");
              break;
            default:
              rarityDot.style.display = "none";
          }
          
          div.appendChild(rarityDot);
        }
        
        // Click event to show details
        div.addEventListener('click', () => showItemDetails(item));
        
        return div;
      }

      // Show item details in modal
      function showItemDetails(item) {
        const itemName = item.description || item.Name || `Item ${item.itemID}`;
        modalTitle.textContent = itemName;
        modalImg.src = `https://freefireinfo.vercel.app/icon?id=${item.itemID}`;
        modalImg.onerror = () => {
          modalImg.src = "https://via.placeholder.com/120x120?text=?";
        };
        
        // Build details HTML
        let detailsHTML = '';
        
        // Item ID with copy button (only place where copy button appears)
        if (item.itemID) {
          detailsHTML += `
            <div class="modal-detail">
              <span class="detail-label">Item ID:</span> ${item.itemID}
              <button class="copy-btn" onclick="copyToClipboard(${item.itemID}, this)">Copy</button>
            </div>
          `;
        }
        
        // Show all fields except hidden ones
        for (const [key, value] of Object.entries(item)) {
          // Skip if field should be hidden or is itemID (already shown above)
          if (HIDDEN_FIELDS.includes(key) || key === 'itemID') continue;
          
          // Skip empty values
          if (value === undefined || value === null || value === '') continue;
          
          detailsHTML += `
            <div class="modal-detail">
              <span class="detail-label">${key}:</span> ${value}
            </div>
          `;
        }
        
        modalDetails.innerHTML = detailsHTML || '<div class="modal-detail">No additional details available</div>';
        itemModal.style.display = "flex";
      }

      // Copy to clipboard function
      window.copyToClipboard = function(text, button) {
        navigator.clipboard.writeText(text.toString()).then(() => {
          button.classList.add('copied');
          button.textContent = 'Copied!';
          setTimeout(() => {
            button.classList.remove('copied');
            button.textContent = 'Copy';
          }, 2000);
        }).catch(err => {
          console.error('Failed to copy: ', err);
        });
      };

      // Setup pagination buttons with all page numbers
      function setupPagination() {
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";
        
        if (totalPages <= 1) return;
        
        // Previous button
        const prevBtn = createPageButton("←", currentPage - 1, "page-nav");
        prevBtn.disabled = currentPage === 1;
        if (currentPage === 1) {
          prevBtn.classList.add("disabled");
        }
        pagination.appendChild(prevBtn);
        
        // Show all page numbers
        for (let i = 1; i <= totalPages; i++) {
          pagination.appendChild(createPageButton(i, i));
        }
        
        // Next button
        const nextBtn = createPageButton("→", currentPage + 1, "page-nav");
        nextBtn.disabled = currentPage === totalPages;
        if (currentPage === totalPages) {
          nextBtn.classList.add("disabled");
        }
        pagination.appendChild(nextBtn);
      }

      function createPageButton(text, page, extraClass = "") {
        const btn = document.createElement("button");
        btn.className = `page-btn ${page === currentPage ? "active" : ""} ${extraClass}`;
        btn.textContent = text;
        btn.dataset.page = page;
        btn.onclick = () => {
          if (!btn.disabled) {
            loadPage(page);
          }
        };
        return btn;
      }

      function updateActiveButton() {
        document.querySelectorAll(".page-btn").forEach(btn => {
          btn.classList.toggle("active", parseInt(btn.dataset.page) === currentPage);
        });
      }

      function showError(message) {
        document.getElementById("loading").style.display = "none";
        const errorEl = document.getElementById("error");
        errorEl.style.display = "block";
        errorEl.innerHTML = `
          <p>Error loading items: ${message}</p>
          <p>Please check console for details (Ctrl+Shift+I)</p>
        `;
      }

      // Initialize the app
      modalClose.addEventListener('click', () => {
        itemModal.style.display = "none";
      });

      // Close modal when clicking outside
      itemModal.addEventListener('click', (e) => {
        if (e.target === itemModal) {
          itemModal.style.display = "none";
        }
      });

      // Search functionality
      searchInput.addEventListener('input', filterItems);

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && itemModal.style.display === "flex") {
          itemModal.style.display = "none";
        }
      });

      // Start the app
      fetchData();
    })
    .catch(error => {
      console.error("Error loading Firebase config:", error);
      showError("Failed to load Firebase configuration");
    });
</script>

</body>
</html>
